#!/bin/bash -eu
shopt -s nullglob

# Note: `/boot/firmware` in the root partition only exists in a booted system; in an unbooted SD
# card, that directory is just the root directory of the boot partition.
init_root=/boot/firmware/init-root

# Extract all init-root archives in lexicographical order:
for archive in /boot/firmware/init-root-*.tar.gz; do
  mkdir -p "$init_root"
  tar \
    -xzvf "$archive" \
    -C "$init_root" \
    --no-same-owner # because tar will fail if we try to keep the owner
  rm "$archive"
done
