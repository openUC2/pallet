package:
  description: >
    Zone-based firewall ambiently provided by the OS, and auto-generated configurations for it from
    a drop-in configuration system
  maintainers:
    - name: Ethan Li
      email: lietk12@gmail.com
  license: GPL-2.0-only
  sources:
    # Ambiently-provided software (GPL-2.0-only):
    - https://github.com/firewalld/firewalld
    # Auto-generation scripts (Apache-2.0):
    - https://github.com/openUC2/pallet

deployment:
  provides:
    file-exports:
      - description:
          Shell script to generate a firewalld zone definition file from drop-in XML fragment files
        target: overlays/usr/libexec/assemble-firewalld-zone
      - description: systemd service to assemble a firewalld zone during boot
        target: overlays/usr/lib/systemd/system/assemble-firewalld-zone@.service

features:
  zone-public:
    description: Generate definition for the public zone
    provides:
      file-exports:
        - description: systemd service enablement for assemble-firewalld-zone@public.service
          target: overlays/etc/systemd/system/firewalld.service.wants/assemble-firewalld-zone@public.service
        - description: Symlink redirecting /etc/firewalld/zones/public.xml to an auto-generated file
          target: overlays/etc/firewalld/zones/public.xml
        - description: Drop-in XML fragment with the required XML declaration
          target: overlays/etc/firewalld/zones.d/public/00-xml-declaration.xml
        - description: Drop-in XML fragment with comment describing XML fragments drop-in directory
          target: overlays/etc/firewalld/zones.d/public/10-README.xml
        - description: Drop-in XML fragment opening the zone definition
          target: overlays/etc/firewalld/zones.d/public/11-header.xml
        - description: Drop-in XML fragment naming and describing the zone
          target: overlays/etc/firewalld/zones.d/public/12-info.xml
        - description: Drop-in XML fragment closing the zone definition
          target: overlays/etc/firewalld/zones.d/public/99-footer.xml
      filesets:
        - description: Drop-in directory for XML fragment files to generate the public zone definition
          tags:
            - drop-in-assembly
          paths:
            - /etc/firewalld/zones.d/public
        - description: Auto-generated public zone definition
          paths:
            - /run/overlays/generated/etc/firewalld/zones/public.xml
  zone-nm-shared:
    description: Generate definition for the nm-shared zone
    provides:
      file-exports:
        - description: systemd service enablement for assemble-firewalld-zone@nm-shared.service
          target: overlays/etc/systemd/system/firewalld.service.wants/assemble-firewalld-zone@nm-shared.service
        - description: Symlink redirecting /etc/firewalld/zones/nm-shared.xml to an auto-generated file
          target: overlays/etc/firewalld/zones/nm-shared.xml
        - description: Drop-in XML fragment with the required XML declaration
          target: overlays/etc/firewalld/zones.d/nm-shared/00-xml-declaration.xml
        - description: Drop-in XML fragment with comment describing XML fragments drop-in directory
          target: overlays/etc/firewalld/zones.d/nm-shared/10-README.xml
        - description: Drop-in XML fragment opening the zone definition
          target: overlays/etc/firewalld/zones.d/nm-shared/11-header.xml
        - description: Drop-in XML fragment naming and describing the zone
          target: overlays/etc/firewalld/zones.d/nm-shared/12-info.xml
        - description: Drop-in XML fragment for a default rejection rule generated by NetworkManager
          target: overlays/etc/firewalld/zones.d/nm-shared/90-rule-default.xml
        - description: Drop-in XML fragment closing the zone definition
          target: overlays/etc/firewalld/zones.d/nm-shared/99-footer.xml
      filesets:
        - description: Drop-in directory for XML fragment files to generate the nm-shared zone definition
          tags:
            - drop-in-assembly
          paths:
            - /etc/firewalld/zones.d/nm-shared
        - description: Auto-generated nm-shared zone definition
          paths:
            - /run/overlays/generated/etc/firewalld/zones/nm-shared.xml
