package:
  description: Program and system services to publish mDNS CNAME aliases via Avahi
  maintainers:
    - name: Ethan Li
      email: lietk12@gmail.com
  license: MIT
  sources:
    # Forklift-deployed software (MIT):
    - https://github.com/grishy/go-avahi-cname
    # Systemd units (Apache-2.0):
    - https://github.com/openUC2/rpi-imswitch-os

deployment:
  provides:
    file-exports:
      - description: go-avahi-cname binary
        source-type: oci-image
        url: ghcr.io/grishy/go-avahi-cname:2.2.6
        source: go-avahi-cname
        target: overlays/usr/bin/go-avahi-cname
      - description: systemd template service to register the specified mDNS name as a CNAME alias
        target: overlays/usr/lib/systemd/system/avahi-publish-cname@.service

features:
  register-openuc2-local:
    description: "Register `openuc2.local` as an alias"
    requires:
      filesets:
        - description: Drop-in directory for hosts fragment files to generate the hosts file
          tags:
            - drop-in-assembly
          paths:
            - /etc/hosts.d
    provides:
      file-exports:
        - description: systemd service enablement
          target: overlays/etc/systemd/system/multi-user.target.wants/avahi-publish-cname@openuc2.local.service
        - description: Drop-in hosts fragment file for locally resolving the mDNS name
          target: overlays/etc/hosts.d/40-mdns-openuc2.local
  register-uc2-local:
    description: "Register `uc2.local` as an alias"
    requires:
      filesets:
        - description: Drop-in directory for hosts fragment files to generate the hosts file
          tags:
            - drop-in-assembly
          paths:
            - /etc/hosts.d
    provides:
      file-exports:
        - description: systemd service enablement
          target: overlays/etc/systemd/system/multi-user.target.wants/avahi-publish-cname@uc2.local.service
        - description: Drop-in hosts fragment file for locally resolving the mDNS name
          target: overlays/etc/hosts.d/40-mdns-uc2.local
